# Docker?
- 컨테이너 기반의 오픈소스 가상화 플랫폼
- 프로그램, 실행환경을 컨테이너로 추상화하고 동일한 인터페이스를 제공하여 프로그램의 배포 및 관리를 단순하게 해주는 역할
- 어떤 프로그램도 컨테이너로 추상화할 수 있고 어디서든 실행할 수 있다.
- 이미지만 있다면 쉽게 배포할 수 있다.

## 컨테이너
- 격리된 공간에서 프로세스를 동작시키는 방법
  - 기존의 가상화 방식 (VMware 등)은 주로 OS를 가상화 함
  - 무겁고 느려서 운영환경에선 사용할 수 없었음
- CPU나 메모리를 필요한 만큼만 사용하기 때문에 성능적으로 손실이 없음

## Image
- 컨테이너 실행에 필요한 파일과 설정값들을 포함하고 있는 것
- Immutable 하여 변하지 않는다.
- 실행하기 위한 모든 정보가 있기 때문에 그대로 컨테이너를 실행하면 된다.

## 장점

### 레이어 저장방식
- 이미지에 수정이 있어서 다시 내려받을 때 모든 것을 다시 내려받는 다면 비효율적
- 레이어 개념을 도입
  - 이미지는 여러개의 read only 레이어로 구성
  - 파일이 추가되거나 수정되면 새로운 레이어가 생성
  - 컨테이너를 생성할 때에도 이미지 레이어 위에 읽기/쓰기 레이어를 추가
    - 컨테이너 실행중에 생성/변경되는 내용은 읽기/쓰기 레이어에 저장
    - 여러 개의 컨테이너를 생성해도 최소한의 용량만 사용
- 유니온 파일 시스템을 이용하여 여러 개의 레이어를 하나의 파일 시스템으로 사용할 수 있게 함


### 이미지 경로
- url 방식으로 이미지를 관리
  - `docker.io/library`가 default
    - ex) ubuntu:14.04 == docker.io/library/ubuntu:14.04
  - tag는 `latest`가 default
    - ex) ubuntu == docker.io/library/ununtu:latest
- 태그 기능이 있어서 버전 관리가 가능

### Dockerfile
- 이미지를 생성 과정을 명시하는 파일
- 서버를 세팅하기 위한 수행해야 하는 업무를 명시적으로 관리할 수 잇음
- 빌드를 하기 위해서는 아래 과정을 반복한다.
  - 임시 컨테이너 생성 -> 명령어 수행 -> 이미지로 저장 -> 임시 컨테이너 삭제 -> 새로 만든 이미지 기반으로 임시 컨테이너 생성 -> 명령어 수행 -> 이미지로 저장 -> 임시 컨테이너 삭제 -> ...

### Docker Hub
- 공개 이미지를 무료로 관리할 수 있음
- 다른 사람이 공개한 이미지를 사용할 수도 있음

### Command와 API
- 직관적인 커맨드 명령어와 쉬운 사용

## 빌드 최적화 하기
### Base Image 활용하기
- python, go, java 등 다양한 베이스 이미지를 활용하기
- 직접 설치하는 과정을 줄일 수 있음

### Build Cache
- 이미지를 빌드하는 과정에서 각 단계를 이미지 레이어로 저장하고 다음 빌드에서 캐시로 사용
- 자주 변경될 수록 Dockerfile의 아래에 두어 캐시를 많이 자주 탈 수 있도록 변경

### 명령어 최적화
- 이미지 빌드시 불필요한 로그는 무시하도록
  - 각 명령어의 `quite` 옵션

### 비슷한 명령어는 묶어주기
- 비슷한 명령어는 묶어준다.
  - ex) RUN apt-get -y -qq update && apt-get -y -qq install ruby
- 스토리지 엔진에 따라 레이어 개수가 제한되는 경우도 있다.

## 참고 자료
- https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html
