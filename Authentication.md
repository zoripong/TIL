# Authentication

## 세션 기반 인증 (서버 기반 인증)

- 사용자가 로그인 한 경우 로그인 중인 정보를 서버측의 메모리 or 디스크 or DB에 저장
  - 해당 정보를 세션이라고 부름

### 단점
- 로그인 중인 사용자가 많아지는 경우 서버측 부하가 심해짐
- 서비스 확장이 어려워짐
  - 분산 시스템 적용을 하기 위해서 각 분산된 서버들끼리의 세션 정보 동기화가 필요해짐.


## 토큰 기반 인증 (JWT)

- 사용자가 로그인 한 경우, 인증에 사용할 수 있는 토큰을 발급해줌
  - 서버는 사용자의 로그인 상태 정보를 저장할 필요가 없어짐
  - 발급된 토큰을 통해 인증된 회원인지 확인
- 서버 측은 상태를 관리하지 않아 stateless(무상태) 함


### 장점

- 서버 확장에 용이해짐
  - 서버에서 로그인 정보를 저장하고 있지 않기 때문에, 서버가 분산되어 있어도 사용자 인증 과정에 문제가 없음

- 플랫폼간 권한 공유 가능
  - 타 서비스에서 구글/페이스북에서 로그인 후 받아온 토큰으로 유저정보를 받아 올 수 있음

- 모바일 어플리케이션에서 사용이 편리해짐
  - 클라이언트에서 단순히 HTTP HEADER에 토큰 정보를 넣어 요청하면 되기 때문에 구현이 단순해짐
  - 쿠키 매니저 등 사용 안 해도 됨

- 웹 표준 [RFC7519][1]에 등록

### 클라이언트에서 토큰을 안전하게 관리하기

#### 웹 스토리지

local storage 혹은 session storage 에 저장 후 API 요청시 HTTP 헤더에 해당 토큰 정보를 포함 시키는 방법

- +) 구현이 쉬움
- +) 하나의 도메인에 제한되어 있지 않음
- -) XSS(Cross Site Scripting) 공격에 의하여 토큰을 탈취당할 수 있음
  - XSS 공격: 악의적인 사용자가 공격하려는 사이트에 스크립트를 포함시켜 쿠키나 세션 등의 민감한 정보를 탈취

#### 쿠키

httpOnly 속성을 활성화 후 쿠키에 토큰을 담아 전달하는 방법
쿠키를 토큰의 전송 수단으로 사용하며, httpOnly 속성에 의해 네트워크 통신 상에서만 토큰 정보가 포함 되어 있게 됨

- +) XSS 공격 위험이 없음
- -) 한정된 도메인에서만 사용이 가능해짐
- -) CSRF(Cross Site Request Forgery) 공격에 의해 사용자가 의도치 않은 요청을 할 가능성이 있음
  - HTTP 요청 레퍼러 체크, CSRF 토큰을 이용하여 방지 가능



## Reference

- https://backend-intro.vlpt.us/4/
- https://velopert.com/2350
- https://itstory.tk/entry/CSRF-%EA%B3%B5%EA%B2%A9%EC%9D%B4%EB%9E%80-%EA%B7%B8%EB%A6%AC%EA%B3%A0-CSRF-%EB%B0%A9%EC%96%B4-%EB%B0%A9%EB%B2%95


## 작성일
- 2020-07-24

[1]: (https://tools.ietf.org/html/rfc7519)

