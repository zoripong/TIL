
# Spring!

- í¬ê²Œ reactive stackê³¼ servelet stackìœ¼ë¡œ ë‚˜ë‰˜ì–´ì§

## Spring MVC?

![spring_mvc.png](/static/TIL/backend/spring/spring_mvc.png)

- servelet stack
- ë‹¤ìˆ˜ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ëŠ” ê²½ìš° Queueì— ìŒ“ì´ê³  Thread Poolì˜ Threadë“¤ì´ ê°€ì ¸ê°€ ì²˜ë¦¬
  - ì¦‰, ìš”ì²­ë‹¹ í•˜ë‚˜ì˜ Threadê°€ í• ë‹¹
  - ìš”ì²­ì´ ì™„ë£Œë  ë•Œê¹Œì§€ Threadë¥¼ ì ìœ í•˜ê²Œ ë¨
- Thread Poolì˜ sizeë³´ë‹¤ ë§ì€ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê²Œ ë˜ë©´ Queueê°€ ìŒ“ì´ê²Œ ë¨ (Thread Pool Hell)
- íŠ¸ë˜í”½ì„ ì¸¡ì •í•˜ì—¬ Pool sizeë¥¼ ì¡°ì •í•´ì•¼ í•¨

## Spring Webflux?

![event_loop.png](/static/TIL/backend/spring/event_loop.png)

- Event driven ë°©ì‹
- Reactor: JVM ìœ„ì—ì„œ ë™ì‘í•˜ëŠ” ë…¼ë¸”ëŸ­í‚¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ê¸° ìœ„í•œ ë¦¬ì•¡í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬
- Node.jsì²˜ëŸ¼ ì´ë²¤íŠ¸ ë£¨í”„ê°€ ëŒê³ , ìš”ì²­ì´ ë°œìƒí•œ ê²½ìš° ê·¸ê²ƒì— ë§ëŠ” í•¸ë“¤ëŸ¬ì—ê²Œ ì²˜ë¦¬ë¥¼ ìœ„ì„í•˜ê³ , ì²˜ë¦¬ê°€ ì™„ë£Œë˜ë©´ callback ë©”ì†Œë“œ ë“±ì„ í†µí•´ ì‘ë‹µì„ ë°˜í™˜ (non-blocking)
- ì‚¬ìš©ì ìš”ì²­ì„ ëŒ€ëŸ‰ìœ¼ë¡œ ë°›ì•„ë‚¼ ìˆ˜ ìˆìŒ
- ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì˜ ìš”ì†Œë“¤ì´ **ëª¨ë‘** ë…¼ë¸”ë¡œí‚¹í•˜ê²Œ ë™ì‘í•´ì•¼ ìœ ì˜ë¯¸
    - íŠ¹ì • êµ¬ê°„ì—ì„œ ë¸”ë¡œí‚¹ì´ ë°œìƒí•œë‹¤ë©´ MVCì™€ ë™ì¼í•œ ë¬¸ì œë“¤ì´ ë°œìƒ
    - R2DBC ë¥¼ ì´ìš©í•˜ì—¬ non-blocking ìœ¼ë¡œ DB connnection ì„ ë§Œë“¤ ìˆ˜ ìˆìŒ
- ì§€ì›í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ëª¨ë¸
    - ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ ë¦¬ì•¡í‹°ë¸Œ ì»´í¬ë„ŒíŠ¸
        - SpringMVCì™€ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„
            - RequestMapping, PathVariable, RestController ë“±
    - í•¨ìˆ˜í˜• ë¼ìš°í„°ì™€ í•¸ë“¤ëŸ¬
        - ë¼ìš°í„° í•¨ìˆ˜
            - RequestPredicateì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ requestë¥¼ ê´€ë¦¬í•˜ëŠ” ë¼ìš°í„°
        - í•¸ë“¤ëŸ¬ í•¨ìˆ˜
            - ë¼ìš°í„° í•¨ìˆ˜ë¡œ í‹€ì–´ì˜¨ reqeustì— ëŒ€í•œ ì²˜ë¦¬ ì •ì˜


### Event-Driven

- í”„ë¡œê·¸ë¨ ì‹¤í–‰ íë¦„ì´ ì´ë²¤íŠ¸ì— ì˜í•´ ê²°ì •ë˜ëŠ” í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„
    - ex. EventLoopëŠ” ì˜ˆâ€”ì „ì— ì½˜ì†” ë§Œë“¤ë•Œ ë°©í–¥í‚¤ ì…ë ¥ ê°ì§€í•˜ë˜ ë¬´í•œë£¨í”„ ë°˜ë³µë¬¸
- Eventê°€ ë°œìƒí•  ë•Œ ì´ë¥¼ ê°ì§€í•˜ê³  ì í•©í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬
- ì–¸ì–´ ë ˆë²¨ì—ì„œ Event Loopë¥¼ ëŒë©´ì„œ ìš”ì²­ì„ ê°ì§€í•˜ê³  ì í•©í•œ Handlerì—ê²Œ ìœ„ì„
    - ê°œë°œìëŠ” ë‹¨ìˆœíˆ Listener ì•¡ì…˜ë§Œ ë“±ë¡í•´ì£¼ë©´ ëœë‹¤.

## MVC vs WebFlux

![MVC_vs_Webflux.png](/static/TIL/backend/spring/MVC_vs_Webflux.png)

boot1 - MVC / boot2 - WebFlux

- ì‚¬ìš©ìê°€ ì ì„ ë•Œì—ëŠ” ìœ ì˜ë¯¸í•œ ì°¨ì´ëŠ” ë°œìƒí•˜ì§€ ì•ŠìŒ
- ë™ê¸°ë°©ì‹ì´ ì½”ë“œì‘ì„±, ì´í•´, ë””ë²„ê¹…ì´ ë” ì‰½ê³  ì§ê´€ì 

## Reactor Meltdown
- í•˜ë‚˜ì˜ ì´ë²¤íŠ¸ê°€ blocking ë˜ë©´ event loop ì „ì²´ê°€ blocking ë˜ë©° ì „ì²´ ì„±ëŠ¥ ì €í•˜ë¥¼ ì¼ìœ¼í‚´
  - í•˜ë‚˜ì˜ ìš”ì²­ ì²˜ë¦¬ê°€ ê¸¸ì–´ì§€ë©´ ë‹¤ë¥¸ ìš”ì²­ì—ë„ ì„±ëŠ¥ ì €í•˜ê°€ ì „íŒŒë¨
- ì´ìœ ëŠ”, nettyì˜ event loop êµ¬ì¡°
  - ë™ì‘ ë°©ì‹ê³¼ êµ¬ì¡°
    - event loopëŠ” ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì ì ˆí•œ í•¸ë“¤ëŸ¬ì—ê²Œ ì „ë‹¬
    - event loop í•˜ë‚˜ì—ì„œ ì—¬ëŸ¬ ì±„ë„ì„ ëª¨ë‹ˆí„°ë§
        - ì±„ë„ì—ì„œ ë°œìƒí•˜ëŠ” connect, accept, read, write ì´ë²¤íŠ¸ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬
    - **ì‹±ê¸€ ìŠ¤ë ˆë“œ**ë¡œ ë™ì‘
    - ëª¨ë“  ì´ë²¤íŠ¸ëŠ” Queueë¡œ ê´€ë¦¬ë˜ë©° FIFO ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬
  - ì‹±ê¸€ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ ì±„ë„ì—ì„œ ì§€ì—°ì´ ìƒê¸°ë©´ ë‹¤ë¥¸ ì±„ë„ì—ë„ ì˜í–¥ì´ ê°
- ì˜ˆë°©ì±…
  - blocking ì‘ì—…ì´ í•„ìš”í•œ ì´ë²¤íŠ¸ëŠ” ê²©ë¦¬ì‹œì¼œì•¼ í•œë‹¤.
  - subscribeOn, publishOnì„ í†µí•´ íŠ¹ì • ìŠ¤ì¼€ì¥´ëŸ¬ì—ê²Œ ìœ„ì„
    - -> ì´ë²¤íŠ¸ ë£¨í”„ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ìŠ¤ì¼€ì¥´ëŸ¬ê°€ ì²˜ë¦¬í•˜ë©´ì„œ ì•ˆì „í•´ì§
  - scheduler factory method ì‚¬ìš©ì„ ê¶Œì¥
    - Schedulers.single()
    - Schedulers.parellel()
    - Schedulers.immediate()
    - Schedulers.boundedElastic()
      - reactorì—ì„œ ê¸´ blocking ë™ì‘ì„ ê²©ë¦¬ì‹œí‚¤ê¸° ìœ„í•´ì„œ ì´ schedulerë¥¼ ì‚¬ìš©í•  ê²ƒì„ ê¶Œì¥í•¨

# Ref

- [https://www.popit.kr/spring-webfluxì™€-kotlinìœ¼ë¡œ-ë§Œë“œëŠ”-todo-ì„œë¹„ìŠ¤-1í¸/](https://www.popit.kr/spring-webflux%EC%99%80-kotlin%EC%9C%BC%EB%A1%9C-%EB%A7%8C%EB%93%9C%EB%8A%94-todo-%EC%84%9C%EB%B9%84%EC%8A%A4-1%ED%8E%B8/)
- [https://velog.io/@dyllis/Spring-MVC-vs-WebFlux](https://velog.io/@dyllis/Spring-MVC-vs-WebFlux) ğŸ‘
- [https://devahea.github.io/2019/04/21/Spring-WebFluxëŠ”-ì–´ë–»ê²Œ-ì ì€-ë¦¬ì†ŒìŠ¤ë¡œ-ë§ì€-íŠ¸ë˜í”½ì„-ê°ë‹¹í• ê¹Œ/](https://devahea.github.io/2019/04/21/Spring-WebFlux%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%A0%81%EC%9D%80-%EB%A6%AC%EC%86%8C%EC%8A%A4%EB%A1%9C-%EB%A7%8E%EC%9D%80-%ED%8A%B8%EB%9E%98%ED%94%BD%EC%9D%84-%EA%B0%90%EB%8B%B9%ED%95%A0%EA%B9%8C/) ğŸ‘
